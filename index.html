<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>3D Modellvergleich – Swipe</title>
<script type="module"
  src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
</script>
<style>
html, body {
  margin:0; padding:0; height:100%; overflow:hidden; font-family:Arial,sans-serif;
}
#sidebar {
  position:fixed; left:0; top:0; bottom:0; width:220px; background:#1e1e1e; padding:20px; color:white; z-index:10;
}
button {
  width:100%; margin-bottom:8px; padding:10px; background:#333; color:white; border:none; border-radius:6px; cursor:pointer;
}
#compareBtn { margin-top:20px; background:#0077ff; }

/* Hauptmodell */
#main { position:fixed; left:220px; right:0; top:0; bottom:0; }
model-viewer { width:100%; height:100%; }

/* Vergleichsmodus Overlay */
#compare {
  position:fixed; inset:0; display:none; background:#f0f0f0; z-index:100;
}
#back { position:absolute; top:16px; left:16px; z-index:200; background:black; color:white; padding:10px 14px; border:none; cursor:pointer; }

/* Vergleichscontainer */
#compareContainer {
  position:relative; width:100%; height:100%; display:flex; justify-content:center; align-items:center;
}

/* Beide Modelle deckungsgleich */
#leftModel, #rightModel {
  position:absolute; width:80%; height:80%; top:50%; left:50%; transform:translate(-50%,-50%);
}

/* Rechtes Modell maskiert */
#rightMask {
  position:absolute; top:0; left:0; width:50%; height:100%; overflow:hidden; z-index:10;
}
#rightMask model-viewer { width:100%; height:100%; }

/* Slider */
#slider {
  position:absolute; top:0; left:50%; width:3px; height:100%; background:red; cursor:ew-resize; z-index:20; transform:translateX(-50%);
}

/* Jahreszahlen Buttons */
#leftYears, #rightYears {
  position:absolute; top:20px; display:flex; flex-direction:column; gap:5px; z-index:200;
}
#leftYears { left:20px; }
#rightYears { right:20px; }
#leftYears button, #rightYears button { width:60px; padding:5px; font-size:12px; }
</style>
</head>
<body>

<div id="sidebar">
  <div id="mainButtons"></div>
  <button id="compareBtn">Vergleichen</button>
</div>

<div id="main">
  <model-viewer id="mainModel" camera-controls interaction-prompt="none"></model-viewer>
</div>

<div id="compare">
  <button id="back">← Zurück</button>
  <div id="compareContainer">
    <model-viewer id="leftModel" camera-controls interaction-prompt="none"></model-viewer>
    <div id="rightMask">
      <model-viewer id="rightModel" camera-controls interaction-prompt="none"></model-viewer>
    </div>
    <div id="slider"></div>
    <div id="leftYears"></div>
    <div id="rightYears"></div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const years=["1150","1175","1374","1550","1630","1936"];
  const mainModel=document.getElementById("mainModel");
  const mainButtons=document.getElementById("mainButtons");

  const compareView=document.getElementById("compare");
  const left=document.getElementById("leftModel");
  const right=document.getElementById("rightModel");
  const rightMask=document.getElementById("rightMask");

  const leftYears=document.getElementById("leftYears");
  const rightYears=document.getElementById("rightYears");

  // Hauptmodell Buttons
  years.forEach(y=>{
    const btn=document.createElement("button");
    btn.textContent=y;
    btn.addEventListener("click",()=>mainModel.src=y+".glb");
    mainButtons.appendChild(btn);
  });

  // Vergleichsmodus Buttons
  function createCompareButtons(container, model){
    years.forEach(y=>{
      const btn=document.createElement("button");
      btn.textContent=y;
      btn.addEventListener("click",()=>model.src=y+".glb");
      container.appendChild(btn);
    });
  }
  createCompareButtons(leftYears,left);
  createCompareButtons(rightYears,right);

  // Vergleichsmodus öffnen/schließen
  const compareBtn=document.getElementById("compareBtn");
  const backBtn=document.getElementById("back");
  compareBtn.addEventListener("click",()=>{
    compareView.style.display="block";
    left.src=mainModel.src;
    right.src=mainModel.src;
  });
  backBtn.addEventListener("click",()=>compareView.style.display="none");

  // Kamera synchronisieren
  let syncing=false;
  function syncCamera(source,target){
    if(syncing) return;
    syncing=true;
    try{
      target.cameraOrbit=source.cameraOrbit;
      target.cameraTarget=source.cameraTarget;
      target.fieldOfView=source.fieldOfView;
    }catch(e){}
    requestAnimationFrame(()=>syncing=false);
  }
  left.addEventListener("camera-change",()=>syncCamera(left,right));
  right.addEventListener("camera-change",()=>syncCamera(right,left));

  // Slider
  const slider=document.getElementById("slider");
  let dragging=false;
  slider.addEventListener("mousedown",()=>dragging=true);
  window.addEventListener("mouseup",()=>dragging=false);
  window.addEventListener("mousemove",e=>{
    if(!dragging) return;
    const rect=document.getElementById("compareContainer").getBoundingClientRect();
    let x=e.clientX-rect.left;
    x=Math.max(0,Math.min(rect.width,x));
    const percent=x/rect.width*100;
    rightMask.style.width=percent+"%";
    slider.style.left=percent+"%";
  });

  // Initial
  mainModel.src="1150.glb";
});
</script>
</body>
</html>
